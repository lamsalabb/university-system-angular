<main class="page-container">
  <div class="list-header">
    <h3 class="list-title">User Management</h3>
    <a
      routerLink="/admin/register-user"
      class="primary-button small-button"
    >
      Register User
    </a>
  </div>

  @if (loading()) {
    <p class="muted-text">Loading usersâ€¦</p>
  }

  @if (error()) {
    <p class="error-text">{{ error() }}</p>
  }

  @if (!loading() && !error()) {
    <div class="list-card">
      <table class="data-table">
        <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Status</th>
          <th class="align-right">Actions</th>
        </tr>
        </thead>

        <tbody>
          @for (u of users(); track u.id) {
            <tr>
              <td>{{ u.firstName }} {{ u.lastName }}</td>
              <td>{{ u.email }}</td>

              <td>
                <span class="status-badge neutral">
                  {{ u.role }}
                </span>
              </td>

              <td>
                <span
                  class="status-badge"
                  [class.success]="u.active"
                  [class.danger]="!u.active"
                >
                  {{ u.active ? 'Active' : 'Inactive' }}
                </span>
              </td>

              <td class="align-right">
                @if (u.role !== 'ADMIN') {
                  <button
                    class="link-button"
                    (click)="openEdit(u)"
                  >
                    Edit
                  </button>

                  <button
                    class="link-button danger"
                    (click)="deleteUser(u.id)"
                  >
                    Delete
                  </button>
                }

                @if (u.role === 'ADMIN') {
                  <span class="muted-text small-italic">Admin</span>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  @if (editingUser()) {
    <div class="modal-backdrop" (click)="closeEdit()">
      <div class="modal-box" (click)="$event.stopPropagation()">

        <h5 class="modal-title">Edit User</h5>

        <div class="form-field">
          <label class="form-label">First Name</label>
          <input
            class="form-input"
            [(ngModel)]="editForm.firstName"
          >
        </div>

        <div class="form-field">
          <label class="form-label">Last Name</label>
          <input
            class="form-input"
            [(ngModel)]="editForm.lastName"
          >
        </div>

        <div class="form-field">
          <label class="form-label">Email</label>
          <input
            type="email"
            class="form-input"
            [(ngModel)]="editForm.email"
          >
        </div>

        <div class="form-field">
          <label class="form-label">New Password</label>
          <input
            type="password"
            class="form-input"
            placeholder="Optional"
            [(ngModel)]="editForm.password"
          >
        </div>

        @if (editingUser()?.role !== 'ADMIN') {
          <label class="checkbox-field">
            <input
              type="checkbox"
              [(ngModel)]="editForm.isActive"
            >
            Active
          </label>
        }


        <div class="form-actions">
          <button
            class="secondary-button small-button"
            (click)="closeEdit()"
          >
            Cancel
          </button>

          <button
            class="primary-button small-button"
            [disabled]="!canSaveUser()"
            (click)="saveEdit()"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  }
  <app-pagination
    [page]="currentPage()"
    [size]="pageSize()"
    [total]="totalElements()"
    [loading]="loading()"
    (pageChange)="currentPage.set($event)"
    (sizeChange)="pageSize.set($event); currentPage.set(0)"
  ></app-pagination>

</main>
