<main class="page-container">

  @if (!selectedCourseId()) {

    <div class="text-center" style="margin-bottom: 3rem;">
      <h3 class="list-title">Mark Attendance</h3>
      <p class="muted-text">
        Select a course to mark todayâ€™s attendance
      </p>
    </div>

    <div class="centered-container">
      <div class="card">
        <div class="card-body">

          <label class="form-label">Course</label>

          <select
            #courseSelect
            (change)="selectCourse(courseSelect.value)"
            class="form-input"
          >

            <option value="">-- Select Course --</option>

            @for (c of courses(); track c.id) {
              <option [value]="c.id">
                {{ c.title }}
              </option>
            }
          </select>

        </div>
      </div>
    </div>

  }

  @if (selectedCourseId()) {

    <div class="list-header">
      <div>
        <h3 class="list-title">Mark Attendance</h3>
        <span class="muted-text">
          Session Date:
          <strong>{{ today }}</strong>
        </span>
      </div>

      <button
        (click)="resetCourse()"
        class="secondary-button small-button"
      >
        Change Course
      </button>
    </div>

    <div class="list-card">

      <table class="data-table">

        <thead>
        <tr>
          <th>Student</th>
          <th>Email</th>
          <th class="center">Present</th>
          <th class="center">Absent</th>
          <th class="center">Excused</th>
        </tr>
        </thead>

        <tbody>

          @if (enrollments().length === 0) {
            <tr>
              <td class="empty-row" colspan="5">
                No students enrolled.
              </td>
            </tr>
          }

          @for (e of enrollments(); track e.id) {
            <tr>

              <td>
                {{ e.student.firstName }}
                {{ e.student.lastName }}
              </td>

              <td>{{ e.student.email }}</td>

              <td class="center">
                <input
                  [(ngModel)]="statusMap[e.id]"
                  [name]="'status_' + e.id"
                  type="radio"
                  value="PRESENT"
                >
              </td>

              <td class="center">
                <input
                  [(ngModel)]="statusMap[e.id]"
                  [name]="'status_' + e.id"
                  type="radio"
                  value="ABSENT"
                >
              </td>

              <td class="center">
                <input
                  [(ngModel)]="statusMap[e.id]"
                  [name]="'status_' + e.id"
                  type="radio"
                  value="EXCUSED"
                />
              </td>

              <td>
                @if (statusMap[e.id] === 'EXCUSED') {
                  <input
                    class="form-input"
                    type="text"
                    placeholder="Reason / remarks"
                    [(ngModel)]="remarksMap[e.id]"
                    [name]="'remarks_' + e.id"
                  />
                }
              </td>




            </tr>
          }

        </tbody>

      </table>

    </div>

    <div class="align-right" style="margin-top: 2.5rem;">
      <button
        (click)="saveAttendance()"
        class="primary-button"
      >
        Save Attendance
      </button>
    </div>

  }

</main>
